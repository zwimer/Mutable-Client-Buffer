Our idea:

Keep map<User, msg> stored, call it MM
	Update MM whenever OnUserMsg is called
		MM[user] = Msg;

OnChanBufferStarting
	chan.old = getBuffer() const;
	new_ = <insert items from MM[user] where needed>
	chan.clearBuffer()
	chan.addBuffer(new_)

